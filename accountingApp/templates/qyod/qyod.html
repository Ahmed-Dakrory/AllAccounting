

{% extends 'accountingmainTemplate.html' %}
{%load static%}

{% block ExtraimportsData %}
      
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
  <!-- Google Fonts -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap">
  <!-- Bootstrap core CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/css/bootstrap.min.css" rel="stylesheet">
  

  <!-- Material Design Bootstrap -->
  
  <link rel="stylesheet" type="text/css" href="{% static 'css/mdb.min.css' %}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/themes/default/style.min.css" />

  <style>

    
  </style>
{% endblock %}


{% block content %}
<div class="p-5">
    <div class="row p-3 mb-2 bg-secondary text-white">
        <h4>الحسابات العامة</h4>

    </div>

    <form  method="POST" id="form" class="needs-validation form-horizontal" novalidate>
      {% csrf_token %}
      <div class="row">
        
        
          <div class="col-md-5 bg-white" style=" height: 890px; overflow: auto; ">
          
            <div class="treeview-animated w-20 border mx-4 my-4 w-100">
              <h6 class="pt-3 pl-3 bg-secondary pb-3" style="color:white;">الدليل المحاسبى للمدفوعات</h6>
            
              <!-- <ul class="treeview-animated-list mb-3"  style=" height: 250px; overflow: overlay; ">
                <li class="treeview-animated-items">
                  <a class="closed">
                    <i class="fas fa-angle-right"></i>
                    <span>مصروفات ادارية</span>
                  </a>
                  <ul class="nested">
                    <li>
                      <div class="treeview-animated-element">أجور ومرتبات</div>
                    </li>
                    <li>
                      <div class="treeview-animated-element">ايجار وكهرباء ومياه</div>
                    </li>
                    <li>
                      <div class="treeview-animated-element">بريد وتليفون</div>
                    </li>
                    <li class="treeview-animated-items">
                      <a class="closed">
                        <i class="fas fa-angle-right"></i>
                        <span>سيارات</span>
                      </a>
                      <ul class="nested">
                        <li>
                          <div class="treeview-animated-element">قطع غيار</div>
                        </li>
                        <li>
                          <div class="treeview-animated-element">استهلاكات</div>
                        </li>
                        <li>
                          <div class="treeview-animated-element">مصروفات أخرى</div>
                        </li>
                      </ul>
                    </li>
                  </ul>
                </li>
              
              </ul> -->
          
          
              <div id="madfo3at_tree"></div>
 
            </div>


            <div class="treeview-animated w-20 border mx-4 my-4 w-100">
              <h6 class="pt-3 pl-3 bg-secondary pb-3" style="color:white;">الدليل المحاسبى للمقبوضات</h6>
            
              
              <div id="maqbodat_tree"></div>
              <!-- <ul class="treeview-animated-list mb-3"  style=" height: 250px; overflow: overlay; ">
                <li class="treeview-animated-items">
                  <a class="closed">
                    <i class="fas fa-angle-right"></i>
                    <span>مقبوضات</span>
                  </a>
                  <ul class="nested">
                    <li>
                      <div class="treeview-animated-element">أجور ومرتبات</div>
                    </li>
                    <li>
                      <div class="treeview-animated-element">ايجار وكهرباء ومياه</div>
                    </li>
                    <li>
                      <div class="treeview-animated-element">بريد وتليفون</div>
                    </li>
                    <li class="treeview-animated-items">
                      <a class="closed">
                        <i class="fas fa-angle-right"></i>
                        <span>سيارات</span>
                      </a>
                      <ul class="nested">
                        <li>
                          <div class="treeview-animated-element">قطع غيار</div>
                        </li>
                        <li>
                          <div class="treeview-animated-element">استهلاكات</div>
                        </li>
                        <li>
                          <div class="treeview-animated-element">مصروفات أخرى</div>
                        </li>
                      </ul>
                    </li>
                  </ul>
                </li>
                <li class="treeview-animated-items">
                  <a class="closed">
                    <i class="fas fa-angle-right"></i>
                    <span>مدفوعات</span>
                  </a>
                  <ul class="nested">
                    <li>
                      <div class="treeview-animated-element">أجور ومرتبات</div>
                    </li>
                    <li>
                      <div class="treeview-animated-element">ايجار وكهرباء ومياه</div>
                    </li>
                    <li>
                      <div class="treeview-animated-element">بريد وتليفون</div>
                    </li>
                    <li class="treeview-animated-items">
                      <a class="closed">
                        <i class="fas fa-angle-right"></i>
                        <span>سيارات</span>
                      </a>
                      <ul class="nested">
                        <li>
                          <div class="treeview-animated-element">قطع غيار</div>
                        </li>
                        <li>
                          <div class="treeview-animated-element">استهلاكات</div>
                        </li>
                        <li>
                          <div class="treeview-animated-element">مصروفات أخرى</div>
                        </li>
                      </ul>
                    </li>
                  </ul>
                </li>
                <li class="treeview-animated-items">
                  <a class="closed">
                    <i class="fas fa-angle-right"></i>
                    <span>أصول</span>
                  </a>
                  <ul class="nested">
                    <li>
                      <div class="treeview-animated-element">أجور ومرتبات</div>
                    </li>
                    <li>
                      <div class="treeview-animated-element">ايجار وكهرباء ومياه</div>
                    </li>
                    <li>
                      <div class="treeview-animated-element">بريد وتليفون</div>
                    </li>
                    <li class="treeview-animated-items">
                      <a class="closed">
                        <i class="fas fa-angle-right"></i>
                        <span>سيارات</span>
                      </a>
                      <ul class="nested">
                        <li>
                          <div class="treeview-animated-element">قطع غيار</div>
                        </li>
                        <li>
                          <div class="treeview-animated-element">استهلاكات</div>
                        </li>
                        <li>
                          <div class="treeview-animated-element">مصروفات أخرى</div>
                        </li>
                      </ul>
                    </li>
                  </ul>
                </li>

                <li class="treeview-animated-items">
                  <a class="closed">
                    <i class="fas fa-angle-right"></i>
                    <span>الخصوم</span>
                  </a>
                  <ul class="nested">
                    <li>
                      <div class="treeview-animated-element">أجور ومرتبات</div>
                    </li>
                    <li>
                      <div class="treeview-animated-element">ايجار وكهرباء ومياه</div>
                    </li>
                    <li>
                      <div class="treeview-animated-element">بريد وتليفون</div>
                    </li>
                    <li class="treeview-animated-items">
                      <a class="closed">
                        <i class="fas fa-angle-right"></i>
                        <span>سيارات</span>
                      </a>
                      <ul class="nested">
                        <li>
                          <div class="treeview-animated-element">قطع غيار</div>
                        </li>
                        <li>
                          <div class="treeview-animated-element">استهلاكات</div>
                        </li>
                        <li>
                          <div class="treeview-animated-element">مصروفات أخرى</div>
                        </li>
                      </ul>
                    </li>
                  </ul>
                </li>
              
                <li class="treeview-animated-items">
                  <a class="closed">
                    <i class="fas fa-angle-right"></i>
                    <span>حسابات تحت التسوية</span>
                  </a>
                  <ul class="nested">
                    <li>
                      <div class="treeview-animated-element">أجور ومرتبات</div>
                    </li>
                    <li>
                      <div class="treeview-animated-element">ايجار وكهرباء ومياه</div>
                    </li>
                    <li>
                      <div class="treeview-animated-element">بريد وتليفون</div>
                    </li>
                    <li class="treeview-animated-items">
                      <a class="closed">
                        <i class="fas fa-angle-right"></i>
                        <span>سيارات</span>
                      </a>
                      <ul class="nested">
                        <li>
                          <div class="treeview-animated-element">قطع غيار</div>
                        </li>
                        <li>
                          <div class="treeview-animated-element">استهلاكات</div>
                        </li>
                        <li>
                          <div class="treeview-animated-element">مصروفات أخرى</div>
                        </li>
                      </ul>
                    </li>
                  </ul>
                </li>


              </ul> -->
            </div>

                        
          </div>
          
          <div class="col-md-7">
            <div class="container mt-4">
              
              <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item" role="presentation">
                  <a class="nav-link active" id="enter-tab" data-toggle="tab" href="#enter" role="tab" aria-controls="enter" aria-selected="true">الأدخال</a>
                </li>
                <li class="nav-item" role="presentation">
                  <a class="nav-link" id="view-tab" data-toggle="tab" href="#view" role="tab" aria-controls="view" aria-selected="false">العرض</a>
                </li>
              </ul>
              <div class="tab-content" id="myTabContent">
                <div class="tab-pane fade show active border p-3" id="enter" role="tabpanel" aria-labelledby="enter-tab" style="direction: rtl;">
                  <div class="row">
                    <div class="form-group bmd-form-group text-center col-md-6 " >
                      <input  required="" id="madfo3at_idSelected"  name="madfo3at_idSelected" class="w-50 required d-none">
                      <div class="invalid-feedback">
                        برجاء اختيار أحد المدفوعات
                      </div>  
                    </div>


                    <div class="form-group bmd-form-group text-center col-md-6">
                      <input  required="" id="maqbodat_idSelected" name="maqbodat_idSelected" class="w-50 required d-none">
                      <div class="invalid-feedback">
                        برجاء اختيار أحد المقبوضات
                      </div>  
                    </div>
                  </div>
                  
                  

                 
                  
                  
                  <div class="row">
                    <div class="col-md-6">
                      <div class="form-group bmd-form-group text-right mt-3">
                        <label for="date" class="text-right">التاريخ</label>
                        <input type="text" required="" type="text" class="w-50 required" name="date" id="date" >
                        <div class="invalid-feedback">
                          برجاء ادخال التاريخ
                        </div>  
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group bmd-form-group text-right mt-3">
                        <label for="Qyed" class="text-right">رقم القيد</label>
                        <input type="text"  type="text" class="w-50 required" name="Qyed" id="Qyed" >
                        
                      </div>
                    </div>
                  </div>

                  <div class="row">
                    <div class="col-md-6">
                      <div class="form-group bmd-form-group text-right">
                        <label for="docNumber" class="text-right">رقم المستند</label>
                        <input type="text" required="" type="text" class="w-50 required" name="docNumber" id="docNumber" >
                        <div class="invalid-feedback">
                          برجاء ادخال رقم المستند
                        </div>  
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group bmd-form-group text-right">
                        <label for="checkNumber" class="text-right">رقم الشيك</label>
                        <input type="text"  type="text" class="w-50 required" name="checkNumber" id="checkNumber" >
                        
                      </div>
                    </div>
                  </div>


                  <div class="row">
                    <div class="col-md-6">
                      <div class="form-group bmd-form-group text-right">
                        <input  type="checkbox"   name="transfer" id="transfer" >
                        <label for="transfer" class=" text-right">عملة</label>
                         
                      </div>
                    </div>

                  </div>


                  <div class="row">
                    <div class="col-md-6">
                      <div class="form-group bmd-form-group">
                        <label for="notes" class="w-100 text-right">البيان</label>
                        <textarea rows="3" maxlength="400"  class="form-control required" name="notes" id="notes" ></textarea> 
                      </div>
                    </div>

                    
                  </div>

                  <div class="row">
                    <div class="w-100 border rounded mr-5 ml-5" style="height: 170px; overflow: auto; ">
                      <table class="table table-sm" style="text-align: right;" id="tableOfmadfo3at">
                        <thead style="background: #acb0b4;">
                          <tr>
                            <th scope="col">اسم الحساب</th>
                            <th scope="col">ملاحظة</th>
                            <th scope="col">المبلغ</th>
                            <th scope="col">العملة</th>
                          </tr>
                        </thead>
                       <tbody>

                       </tbody>
                      </table>
                    </div>
                  </div>

                  <div class="mt-3 ml-3 row">
                    <div class="col-md-7"></div>
                    <div class="col-md-5">
                      <div class="form-group bmd-form-group text-left">
                        <label for="totalEnter" class="text-right">الاجمالى</label>
                        <input type="text" required="" type="text" class="w-50 required" name="totalEnter" id="totalEnter" >
                        <div class="invalid-feedback">
                          برجاء ادخال الاجمالى 
                        </div>  
                      </div>
                    </div>

                  </div>


                  <div class="row mt-3">
                    <div class="w-100 border rounded mr-5 ml-5" style="height: 170px; overflow: auto; ">
                      <table class="table table-sm" style="text-align: right;" id="tableOfmaqbodat">
                        <thead style="background: #acb0b4;">
                          <tr>
                            <th scope="col">اسم الحساب</th>
                            <th scope="col">ملاحظة</th>
                            <th scope="col">المبلغ</th>
                            <th scope="col">العملة</th>
                          </tr>
                        </thead>
                        <tbody>
                         
                         


                          
                        </tbody>
                      </table>
                    </div>
                  </div>

                  <div class="mt-3 ml-3 row">
                    <div class="col-md-7"></div>
                    <div class="col-md-5">
                      <div class="form-group bmd-form-group text-left">
                        <label for="totalout" class="text-right">الاجمالى</label>
                        <input type="text" required="" type="text" class="w-50 required" name="totalout" id="totalout" >
                        <div class="invalid-feedback">
                          برجاء ادخال الاجمالى 
                        </div>  
                      </div>
                    </div>

                  </div>




                  <div class="mt-3 ml-3 row">
                    <div class="col-md-7"></div>
                    <div class="col-md-5">
                      <div class="form-group bmd-form-group text-left">
                        <button type="submit">اتمام العملية</button>
                      </div>
                    </div>

                  </div>
                </div>
                <div class="tab-pane fade" id="view" role="tabpanel" aria-labelledby="view-tab">
                  <br>
                  <div class="list-group">
               
                    {% for item in allTransactions %}
                    <button type="button" class="list-group-item list-group-item-action buttonToShowDoc" id="docShowButton_{{item.id}}">مستند رقم {{item.Doc_Number}}</button>
                    {% endfor %}
                  </div>

                </div>
              </div>
            </div>           
          </div>

      </div>
    </form>
</div>


{% endblock %}

{% block Extrajavascripts %}


<!-- Bootstrap tooltips -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.4/umd/popper.min.js"></script>
<!-- Bootstrap core JavaScript -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/js/bootstrap.min.js"></script>
<!-- MDB core JavaScript -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/js/mdb.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/jstree.min.js"></script>

<script>
hideLoader();




(function() {
    'use strict';
    window.addEventListener('load', function() {
    // Fetch all the forms we want to apply custom Bootstrap validation styles to
    var forms = document.getElementsByClassName('needs-validation');
    // Loop over them and prevent submission
    var validation = Array.prototype.filter.call(forms, function(form) {
    form.addEventListener('submit', function(event) {
    if (form.checkValidity() === false) {
    event.preventDefault();
    event.stopPropagation();
    }
    form.classList.add('was-validated');
    }, false);
    });
    }, false);
    })();





// Treeview Initialization
$(document).ready(function() {
  $('.treeview-animated').mdbTreeview();
});


$(function () { 
  
  $(".buttonToShowDoc").click(function(event){
        idOfElement = (event.target.id).slice(14, (event.target.id).length);
        
  $.ajax({
        url: "/{{LANGUAGE_CODE}}/accounting/getTransactionDetails/",
        type: "post",
        data: {
          id:idOfElement
        } ,
        headers:{
                "X-CSRFToken": csrftoken
        }
        ,
        success: function (response) {
          if(response.Result=="Ok"){
          

            console.log(response.Data);
            $('#date').attr('value',response.Data.date);
            $("#date").val(response.Data.date);
            
            
            $('#Qyed').attr('value',response.Data.Qyed_Number);
            $("#Qyed").val(response.Data.Qyed_Number);

            
            $('#docNumber').attr('value',response.Data.Doc_Number);
            $("#docNumber").val(response.Data.Doc_Number);

            
            $('#checkNumber').attr('value',response.Data.Check_Number);
            $("#checkNumber").val(response.Data.Check_Number);

            
            $('#notes').attr('value',response.Data.Notes);
            $("#notes").val(response.Data.Notes);

            
            $('#totalEnter').attr('value',response.Data.madfo3at_Total);
            $("#totalEnter").val(response.Data.madfo3at_Total);

            
            $('#totalout').attr('value',response.Data.maqbodat_Total);
            $("#totalout").val(response.Data.maqbodat_Total);

            
            $('#date').attr('value',response.Data.date);
            $("#date").val(response.Data.date);




            
            newRowContent = `
                          <tr>
                            <td style=" padding: 0; margin: 0; "><input type="hidden" id="madfo3at_allLength" name="madfo3at_allLength" value="`+(response.Data.acc_codes_With_details_madfo3at).length+`" class="w-100"></td>
                          </tr>

                         `;
            for( i=0;i<(response.Data.acc_codes_With_details_madfo3at).length;i++){
              
            $('#madfo3at_idSelected').attr('value',response.Data.madfo3atId);
            $("#madfo3at_idSelected").val(response.Data.madfo3atId);
              dataContainer = response.Data.acc_codes_With_details_madfo3at[i];
              newRowContent += `
                          <tr>
                            <td style=" display: none; ">
                              <input type="hidden" id="madfo3ataccountDivLen_`+i+`" name="madfo3ataccountDivLen_`+i+`"   value="`+dataContainer.accountNumber+`">
                            </td>
                            <td  style="background: #acb0b4;  padding: 0; margin: 0;">
                              <input type="text" class="w-100" id="accountId_`+dataContainer.accountNumber+`" name="accountId_`+dataContainer.accountNumber+`"  style="background: #acb0b4;"  value="`+dataContainer.account+`">
                            </td>
                            <td style=" padding: 0; margin: 0; "><input type="text" id="accountNote_`+dataContainer.accountNumber+`" name="accountNote_`+dataContainer.accountNumber+`" value="`+dataContainer.note+`" class="w-100"></td>
                            <td style=" padding: 0; margin: 0; "><input type="number" step="0.000001" lang="ar" id="accountPrice_`+dataContainer.accountNumber+`" name="accountPrice_`+dataContainer.accountNumber+`" value="`+dataContainer.price+`" class="w-100"></td>
                            <td style=" padding: 0; margin: 0; "><input type="text" id="accountCurrency_`+dataContainer.accountNumber+`" name="accountCurrency_`+dataContainer.accountNumber+`" value="`+dataContainer.currency+`" class="w-100"></td>
                          </tr>

                         `;
            }
            $("#tableOfmadfo3at tbody").empty();
            $("#tableOfmadfo3at tbody").append(newRowContent);







            newRowContent = `
                          <tr>
                            <td style=" padding: 0; margin: 0; "><input type="hidden" id="maqbodat_allLength" name="maqbodat_allLength" value="`+(response.Data.acc_codes_With_details_maqbodat).length+`" class="w-100"></td>
                          </tr>

                         `;
            for( i=0;i<(response.Data.acc_codes_With_details_maqbodat).length;i++){
              
            $('#maqbodat_idSelected').attr('value',response.Data.maqbodatId);
            $("#maqbodat_idSelected").val(response.Data.maqbodatId);
              dataContainer = response.Data.acc_codes_With_details_maqbodat[i];
              newRowContent += `
                          <tr>
                            <td style=" display: none; ">
                              <input type="hidden" id="maqbodataccountDivLen_`+i+`" name="maqbodataccountDivLen_`+i+`"   value="`+dataContainer.accountNumber+`">
                            </td>
                            <td  style="background: #acb0b4;  padding: 0; margin: 0;">
                              <input type="text" class="w-100" id="accountId_`+dataContainer.accountNumber+`" name="accountId_`+dataContainer.accountNumber+`"  style="background: #acb0b4;"  value="`+dataContainer.account+`">
                            </td>
                            <td style=" padding: 0; margin: 0; "><input type="text" id="accountNote_`+dataContainer.accountNumber+`" name="accountNote_`+dataContainer.accountNumber+`" value="`+dataContainer.note+`" class="w-100"></td>
                            <td style=" padding: 0; margin: 0; "><input type="number" step="0.000001" lang="ar" id="accountPrice_`+dataContainer.accountNumber+`" name="accountPrice_`+dataContainer.accountNumber+`" value="`+dataContainer.price+`" class="w-100"></td>
                            <td style=" padding: 0; margin: 0; "><input type="text" id="accountCurrency_`+dataContainer.accountNumber+`" name="accountCurrency_`+dataContainer.accountNumber+`" value="`+dataContainer.currency+`" class="w-100"></td>
                          </tr>

                         `;
            }
            $("#tableOfmaqbodat tbody").empty();
            $("#tableOfmaqbodat tbody").append(newRowContent);

            $('[href="#enter"]').tab('show');
          }
          
           // You will get response from your PHP page (what you echo or print)
        },
        error: function(jqXHR, textStatus, errorThrown) {
           console.log(textStatus, errorThrown);
        }
    });



    }); 



  $('#maqbodat_tree').jstree({
  "core" : {
    "animation" : 0,
    "check_callback" : true,
    "themes" : { "stripes" : true },
    'data' : {
      'url' : function (node) {
        return '/{{LANGUAGE_CODE}}/accounting/treeOfMain';
      },
      'data' : function (node) {
        return { 
          'id' : node.id,
          'treeType':0
         };
      }
    }
  },
  "types" : {
    // "#" : {
    //   "max_children" : 1,
    //   "max_depth" : 4,
    //   "valid_children" : ["root"]
    // },
    // "root" : {
    //   "icon" : "https://www.jstree.com/static/3.3.11/assets/images/tree_icon.png",
    //   "valid_children" : ["default"]
    // },
    "default" : {
      "valid_children" : ["default","file"]
    },
    "file" : {
      "icon" : "glyphicon glyphicon-minus",
      "valid_children" : []
    }
  },
  // "plugins" : [
  //   "contextmenu", "dnd", "search",
  //   "state", "types", "wholerow"
  // ]
});



$('#maqbodat_tree').on("changed.jstree", function (e, data) {
  console.log(data.selected[0].slice(7, (data.selected[0]).length));

  
  
            $('#maqbodat_idSelected').attr('value',"");
            $("#maqbodat_idSelected").val("");
  
  $.ajax({
        url: "/{{LANGUAGE_CODE}}/accounting/getAllElementsRelatedToTreeElementAndType/",
        type: "post",
        data: {
          id:data.selected[0].slice(7, (data.selected[0]).length),
          Type:1
        } ,
        headers:{
                "X-CSRFToken": csrftoken
        }
        ,
        success: function (response) {
          if(response.Result=="Ok"){
          

            
            newRowContent = `
                          <tr>
                            <td style=" padding: 0; margin: 0; "><input type="hidden" id="maqbodat_allLength" name="maqbodat_allLength" value="`+response.length+`" class="w-100"></td>
                          </tr>

                         `;
            for( i=0;i<response.length;i++){
              
            $('#maqbodat_idSelected').attr('value',data.selected[0].slice(7, (data.selected[0]).length));
            $("#maqbodat_idSelected").val(data.selected[0].slice(7, (data.selected[0]).length));
              dataContainer = response.output[i];
              newRowContent += `
                          <tr>
                            <td style=" display: none; ">
                              <input type="hidden" id="maqbodataccountDivLen_`+i+`"  name="maqbodataccountDivLen_`+i+`"  value="`+dataContainer.accountNumber+`">
                            </td>
                            <td  style="background: #acb0b4;  padding: 0; margin: 0;">
                              <input type="text" class="w-100" id="accountId_`+dataContainer.accountNumber+`" name="accountId_`+dataContainer.accountNumber+`"  style="background: #acb0b4;"  value="`+dataContainer.text+`">
                            </td>
                            <td style=" padding: 0; margin: 0; "><input type="text" id="accountNote_`+dataContainer.accountNumber+`"  name="accountNote_`+dataContainer.accountNumber+`" class="w-100"></td>
                            <td style=" padding: 0; margin: 0; "><input type="number" step="0.000001"  id="accountPrice_`+dataContainer.accountNumber+`" name="accountPrice_`+dataContainer.accountNumber+`" value="0" class="w-100"></td>
                            <td style=" padding: 0; margin: 0; "><input type="text" id="accountCurrency_`+dataContainer.accountNumber+`" name="accountCurrency_`+dataContainer.accountNumber+`" class="w-100"></td>
                          </tr>

                         `;
            }
            $("#tableOfmaqbodat tbody").empty();
            $("#tableOfmaqbodat tbody").append(newRowContent);
            console.log(response.output);
            console.log(response.length);
            console.log("Ahmed");
          }
          
           // You will get response from your PHP page (what you echo or print)
        },
        error: function(jqXHR, textStatus, errorThrown) {
           console.log(textStatus, errorThrown);
        }
    });


    
});






$('#madfo3at_tree').jstree({
  "core" : {
    "animation" : 0,
    "check_callback" : true,
    "themes" : { "stripes" : true },
    'data' : {
      'url' : function (node) {
        return '/{{LANGUAGE_CODE}}/accounting/treeOfMain';
      },
      'data' : function (node) {
        return { 
          'id' : node.id,
          'treeType':1
         };
      }
    }
  },
  "types" : {
    // "#" : {
    //   "max_children" : 1,
    //   "max_depth" : 4,
    //   "valid_children" : ["root"]
    // },
    // "root" : {
    //   "icon" : "https://www.jstree.com/static/3.3.11/assets/images/tree_icon.png",
    //   "valid_children" : ["default"]
    // },
    "default" : {
      "valid_children" : ["default","file"]
    },
    "file" : {
      "icon" : "glyphicon glyphicon-minus",
      "valid_children" : []
    }
  },
  // "plugins" : [
  //   "contextmenu", "dnd", "search",
  //   "state", "types", "wholerow"
  // ]
});



$('#madfo3at_tree').on("changed.jstree", function (e, data) {
  console.log(data.selected[0].slice(7, (data.selected[0]).length));
  
  $('#madfo3at_idSelected').attr('value',"");
  $("#madfo3at_idSelected").val("");
  
  $.ajax({
        url: "/{{LANGUAGE_CODE}}/accounting/getAllElementsRelatedToTreeElementAndType/",
        type: "post",
        data: {
          id:data.selected[0].slice(7, (data.selected[0]).length),
          Type:1
        } ,
        headers:{
                "X-CSRFToken": csrftoken
        }
        ,
        success: function (response) {
          if(response.Result=="Ok"){
          
            newRowContent = `
                          <tr>
                            <td style=" padding: 0; margin: 0; "><input type="hidden" id="madfo3at_allLength" name="madfo3at_allLength" value="`+response.length+`" class="w-100"></td>
                          </tr>

                         `;
            for( i=0;i<response.length;i++){
              
            $('#madfo3at_idSelected').attr('value',data.selected[0].slice(7, (data.selected[0]).length));
            $("#madfo3at_idSelected").val(data.selected[0].slice(7, (data.selected[0]).length));
              dataContainer = response.output[i];
              newRowContent += `
                          <tr>
                            <td style=" display: none; ">
                              <input type="hidden" id="madfo3ataccountDivLen_`+i+`" name="madfo3ataccountDivLen_`+i+`"   value="`+dataContainer.accountNumber+`">
                            </td>
                            <td  style="background: #acb0b4;  padding: 0; margin: 0;">
                              <input type="text" class="w-100" id="accountId_`+dataContainer.accountNumber+`" name="accountId_`+dataContainer.accountNumber+`"  style="background: #acb0b4;"  value="`+dataContainer.text+`">
                            </td>
                            <td style=" padding: 0; margin: 0; "><input type="text" id="accountNote_`+dataContainer.accountNumber+`" name="accountNote_`+dataContainer.accountNumber+`" value="" class="w-100"></td>
                            <td style=" padding: 0; margin: 0; "><input type="number" step="0.000001" lang="ar" id="accountPrice_`+dataContainer.accountNumber+`" name="accountPrice_`+dataContainer.accountNumber+`" value="0" class="w-100"></td>
                            <td style=" padding: 0; margin: 0; "><input type="text" id="accountCurrency_`+dataContainer.accountNumber+`" name="accountCurrency_`+dataContainer.accountNumber+`" class="w-100"></td>
                          </tr>

                         `;
            }
            $("#tableOfmadfo3at tbody").empty();
            $("#tableOfmadfo3at tbody").append(newRowContent);
            console.log(response.output);
            console.log(response.length);
            console.log("Ahmed");
          }
          
           // You will get response from your PHP page (what you echo or print)
        },
        error: function(jqXHR, textStatus, errorThrown) {
           console.log(textStatus, errorThrown);
        }
    });


});

  });
</script>


{% endblock %}